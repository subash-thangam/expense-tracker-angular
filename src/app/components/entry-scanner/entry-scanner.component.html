<div class="scanner-modal" *ngIf="isOpen" (click)="closeScanner()" [class.loading]="isScanning">
  <div class="scanner-content" (click)="$event.stopPropagation()">
    <div class="scanner-header">
      <h3>Scan QR Code</h3>
      <button class="close-btn" (click)="closeScanner()" [disabled]="isScanning">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="scanner-body">
      <div *ngIf="!hasPermission && errorMessage" class="error-message">
        {{ errorMessage }}
      </div>

      <div *ngIf="hasPermission && !isScanning" class="scanner-box">
        <zxing-scanner [formats]="formats" (camerasFound)="onCamerasFound($event)"
          (permissionResponse)="onHasPermission($event)" (scanSuccess)="onScanSuccess($event)" [tryHarder]="true">
        </zxing-scanner>
        <div class="scanner-overlay">
          <div class="scan-frame"></div>
        </div>
      </div>

      <div *ngIf="isScanning" class="scanning-state">
        <div class="spinner"></div>
        <p>Processing scan...</p>
      </div>
    </div>
  </div>
</div>
