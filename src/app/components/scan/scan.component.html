<div class="scan-container">
    <div class="scan-header">
        <button class="icon-btn close-btn" (click)="goBack()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <h2>Scan UPI QR</h2>
    </div>

    <div class="scanner-wrapper">
        <div *ngIf="errorMessage" class="error-msg">
            {{ errorMessage }}
            <button class="btn btn-secondary" (click)="retryCamera()">Retry</button>
        </div>

        <div class="scanner-box" *ngIf="showScanner">
            <zxing-scanner 
                *ngIf="isScanning"
                [formats]="formats" 
                (camerasFound)="onCamerasFound($event)"
                (permissionResponse)="onHasPermission($event)" 
                (scanSuccess)="onScanSuccess($event)"
                (scanFailure)="onScanError($event)"
                [tryHarder]="true"
                [autofocus]="true">
            </zxing-scanner>

            <div class="scan-overlay">
                <div class="scan-frame">
                    <div class="corner corner-tl"></div>
                    <div class="corner corner-tr"></div>
                    <div class="corner corner-bl"></div>
                    <div class="corner corner-br"></div>
                </div>
            </div>
        </div>

        <div *ngIf="!errorMessage && !hasPermission && !hasDevices" class="loading-msg">
            <div class="spinner"></div>
            Initializing camera...
        </div>
    </div>

    <div class="scan-footer">
        <p>Align QR code within the frame to pay</p>
    </div>
</div>